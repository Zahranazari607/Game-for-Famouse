<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <title>WIFIChicken-Mini Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        :root{--bg:#071622;--panel:#0e2a35;--accent:#28e0c6;--muted:#9fb8bf;--good:#9ef08a;--bad:#ff7a7a;--gold:#ffd166;}
        html,body{height:100%;background:linear-gradient(180deg,#04101a 0%,#06232e 70%);color:#e8f1f4}
        .game-card{background:#0e2a35;border:1px solid #163746;border-radius:1rem;box-shadow:0 10px 30px rgba(0,0,0,.35)}
        #game{position:relative;height:64vh;max-height:640px;background:#081b26;border-radius:1rem;overflow:hidden;touch-action:none;font-size:32px;line-height:1}
        #game:focus{outline:2px solid var(--accent)}
        .hud{font-weight:600;color:var(--muted)}
        .btn-accent{background:var(--accent);border:none;color:#06232e;font-weight:700}
        .entity{position:absolute;will-change:transform,opacity}
        .chicken{width:42px;height:42px}
        .fox{width:48px;height:30px}
        .wifi{width:32px;height:32px}
        .emoji{font-size:32px;}
        .pop{position:absolute;color:#fff;font-weight:700;text-shadow:0 2px 8px rgba(0,0,0,.35);pointer-events:none}
        .paused-overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);backdrop-filter:blur(2px)}
        .show{display:flex!important}
        @media (max-width: 900px){#game{height:72vh}}
    </style>
</head>

<body>
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="p-3 p-md-4 game-card">
                    <div class="d-flex align-items-center justify-content-between gap-2 mb-3">
                        <div class="hud">
                        <span class="me-3">Score: <span id="score">0</span></span>
                        <span class="me-3">Best: <span id="best">0</span></span>
                        <span class="me-3">Lives: <span id="lives">3</span></span>
                        <span class="me-3">Stars: <span id="stars">0</span></span>
                        <span>Chances: <span id="chances">0</span></span>
                        </div>
                        <div class="d-flex gap-2">
                        <button class="btn btn-sm btn-accent" id="startBtn">Start</button>
                        <button class="btn btn-sm btn-outline-light" id="pauseBtn">Pause</button>
                        <button class="btn btn-sm btn-outline-warning" id="resetBtn">Reset</button>
                        </div>
                    </div>

                <div id="game" tabindex="0" aria-label="WIFIChicken Game Area" role="application"></div>
                <div class="paused-overlay" id="pausedOverlay"><h2 class="fw-bold">Paused</h2></div>

                <p class="mt-3 small text-secondary">
                    Controls: <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> <kbd>‚Üë</kbd> <kbd>‚Üì</kbd> to move, <kbd>Space</kbd> to dash / pause. Touch/drag on mobile. Collect WiFi orbs, avoid the fox!
                </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function(){
        const game=document.getElementById('game');
        const scoreEl=document.getElementById('score');
        const bestEl=document.getElementById('best');
        const livesEl=document.getElementById('lives');
        const starsEl=document.getElementById('stars');
        const chancesEl=document.getElementById('chances');
        const startBtn=document.getElementById('startBtn');
        const pauseBtn=document.getElementById('pauseBtn');
        const resetBtn=document.getElementById('resetBtn');
        const pausedOverlay=document.getElementById('pausedOverlay');

        let running=false,paused=false;
        let score=0,best=Number(localStorage.getItem('wifiChickenBest')||0);
        let lives=3,stars=0,chances=1,lastTime=0;

        const player={x:100,y:100,w:42,h:42,vx:0,vy:0,speed:280,dash:520,cooldown:0};
        const foxes=[],orbs=[];

        bestEl.textContent=best;

        const playerEl = document.createElement('div');
        playerEl.className = 'entity chicken emoji';
        playerEl.textContent = 'üêé';
        playerEl.dataset.dir = -1;  // ÿ¨Ÿáÿ™ ÿßŸàŸÑ€åŸá ÿ®Ÿá ⁄ÜŸæ
        playerEl.style.transform = 'scaleX(-1)';
        game.appendChild(playerEl);


        // ÿµÿØÿßŸáÿß€å ÿπŸÖŸàŸÖ€å
        function playBeep(freq,duration,type="sine",vol=0.4){
        const ctx=new (window.AudioContext||window.webkitAudioContext)();
        const osc=ctx.createOscillator();
        const gain=ctx.createGain();
        osc.type=type; osc.frequency.value=freq;
        gain.gain.setValueAtTime(vol,ctx.currentTime);
        osc.connect(gain); gain.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime+duration/1000);
        }
        // ÿßŸÅ⁄©ÿ™ Ÿáÿß€å ÿµÿØÿß€å€å
        function soundStart(){ playBeep(600,200,"sine",0.5); }
        function soundCollect(){ playBeep(800,150,"triangle",0.4); }
        function soundHitFox(){
        const ctx=new (window.AudioContext||window.webkitAudioContext)();
        const osc=ctx.createOscillator(); const gain=ctx.createGain();
        osc.type="square"; osc.frequency.value=120;
        gain.gain.setValueAtTime(0.3,ctx.currentTime);
        osc.frequency.linearRampToValueAtTime(40,ctx.currentTime+0.15);
        osc.connect(gain); gain.connect(ctx.destination);
        osc.start(); osc.stop(ctx.currentTime+0.2);
        }
        function soundGameOver(){ playBeep(120,400,"sawtooth",0.5); }

        function spawnFox(){
        const el=document.createElement('div');
        el.className='entity fox emoji';
        el.textContent='ü¶Å';
        game.appendChild(el);
        foxes.push({x:game.clientWidth+40,y:Math.random()*(game.clientHeight-30),w:48,h:30,vx:-150,el});
        }
        function spawnOrb(){
        const el=document.createElement('div');
        el.className='entity wifi emoji';
        el.textContent='üì∂';
        game.appendChild(el);
        orbs.push({x:Math.random()*(game.clientWidth-30),y:-30,w:32,h:32,vy:100,el});
        }

        function popText(text,x,y,color){
        const p=document.createElement('div');
        p.className='pop'; p.textContent=text;
        p.style.left=x+'px'; p.style.top=y+'px'; p.style.color=color||'#fff';
        game.appendChild(p);
        let t=0; const dur=800;
        const anim=(ts)=>{
            if(!t)t=ts; const dt=ts-t; const k=dt/dur;
            p.style.transform=`translateY(${-30*k}px)`; p.style.opacity=String(1-k);
            if(dt<dur)requestAnimationFrame(anim); else game.removeChild(p);
        };
        requestAnimationFrame(anim);
        }

        function checkRewards(){
        if(score>=1000 && stars<1){stars=1; popText("‚≠ê Star!",player.x,player.y-40,"#ffd166");}
        if(score>=10000 && stars<2){stars=2; popText("‚≠ê Star!",player.x,player.y-40,"#ffd166");}
        starsEl.textContent=stars; chancesEl.textContent=chances;
        }

        const keys=new Set();
        game.addEventListener('keydown',e=>{
        if(['ArrowLeft','ArrowRight','ArrowUp','ArrowDown','Space'].includes(e.code)) e.preventDefault();
        keys.add(e.code);
        });
        game.addEventListener('keyup',e=>{
        keys.delete(e.code);
        if(e.code==="Space"){ togglePause(); }
        });

        let dragging=false;
        game.addEventListener('pointerdown',e=>{dragging=true;game.setPointerCapture(e.pointerId);});
        game.addEventListener('pointerup',e=>{dragging=false;});
        game.addEventListener('pointermove',e=>{
        if(!dragging) return;
        const rect=game.getBoundingClientRect();
        player.x=Math.max(0,Math.min(game.clientWidth-player.w,e.clientX-rect.left-player.w/2));
        player.y=Math.max(0,Math.min(game.clientHeight-player.h,e.clientY-rect.top-player.h/2));
        });

        function reset(){
        score=0;lives=3;stars=0;chances=1;
        foxes.forEach(f=>f.el.remove()); foxes.length=0;
        orbs.forEach(o=>o.el.remove()); orbs.length=0;
        scoreEl.textContent=score; livesEl.textContent=lives;
        starsEl.textContent=stars; chancesEl.textContent=chances;
        player.x=20;player.y=100;player.vx=0;player.vy=0;player.cooldown=0;
        }

        function start(){
        if(running) return;
        reset(); running=true; paused=false; lastTime=0;
        pausedOverlay.classList.remove('show'); game.focus();
        soundStart(); // ÿßÿ≥ÿ™ÿßÿ±ÿ™ ÿ®ÿßÿ≤€å ÿ®ÿß ÿµÿØÿß
        requestAnimationFrame(loop);
        }

        function togglePause(){
        if(!running) return;
        paused=!paused;
        pausedOverlay.classList.toggle('show',paused);
        if(!paused){lastTime=0; requestAnimationFrame(loop);}
        }

        startBtn.addEventListener('click',start);
        pauseBtn.addEventListener('click',togglePause);
        resetBtn.addEventListener('click',()=>{reset(); game.focus();});

        function rectsOverlap(a,b){return !(a.x+a.w<b.x || a.x>b.x+b.w || a.y+a.h<b.y || a.y>b.y+b.h);}

        function loop(ts){
        if(!running||paused) return;
        if(!lastTime) lastTime=ts;
        const dt=Math.min(32,ts-lastTime)/1000;
        lastTime=ts;

        if(Math.random()<0.02) spawnFox();
        if(Math.random()<0.035) spawnOrb();

        const left=keys.has('ArrowLeft'), right=keys.has('ArrowRight'), up=keys.has('ArrowUp'), down=keys.has('ArrowDown');
        const dashing=keys.has('Space') && player.cooldown<=0;
        const vxTarget=(right-left)*(dashing?player.dash:player.speed);
        const vyTarget=(down-up)*(dashing?player.dash:player.speed);
        player.vx+=(vxTarget-player.vx)*(dashing?0.6:0.25);
        player.vy+=(vyTarget-player.vy)*(dashing?0.6:0.25);
        if(dashing) player.cooldown=0.8;
        if(player.cooldown>0) player.cooldown-=dt;

        player.x=Math.max(0,Math.min(game.clientWidth-player.w,player.x+player.vx*dt));
        player.y=Math.max(0,Math.min(game.clientHeight-player.h,player.y+player.vy*dt));

        // ÿ¨Ÿáÿ™ ÿ≠ÿ±⁄©ÿ™ ÿßÿ≥ÿ®
        if (player.vx > 0) {
            playerEl.style.transform = `translate(${player.x}px,${player.y}px) scaleX(1)`; // ÿ®Ÿá ÿ±ÿßÿ≥ÿ™
            playerEl.dataset.dir = 1;
        } else if (player.vx < 0) {
            playerEl.style.transform = `translate(${player.x}px,${player.y}px) scaleX(-1)`; // ÿ®Ÿá ⁄ÜŸæ
            playerEl.dataset.dir = -1;
        } else {
            playerEl.style.transform = `translate(${player.x}px,${player.y}px) scaleX(${playerEl.dataset.dir})`;
        }

        for(let i=foxes.length-1;i>=0;i--){
            const f=foxes[i];
            f.x+=f.vx*dt;
            if(f.x<-60){f.el.remove();foxes.splice(i,1);continue;}
            f.el.style.transform=`translate(${f.x}px,${f.y}px)`;
            if(rectsOverlap(player,f)){
            lives--; livesEl.textContent=lives;
            popText('-1',player.x,player.y-10,'#ff7a7a');
            soundHitFox(); 
            f.el.remove(); foxes.splice(i,1);
            if(lives<=0){
                running=false;
                pausedOverlay.classList.add('show');
                pausedOverlay.innerHTML=`<div class="text-center"><h2 class="fw-bold">Game Over</h2><p class="mb-3">Score: ${score}</p><button class="btn btn-accent" id="again">Play Again</button></div>`;
                soundGameOver(); 
                document.getElementById('again').addEventListener('click',()=>{pausedOverlay.classList.remove('show'); pausedOverlay.innerHTML='<h2 class="fw-bold">Paused</h2>'; start();});
                if(score>best){best=score; localStorage.setItem('wifiChickenBest',best); bestEl.textContent=best;}
                return;
            }
            }
        }

        for(let i=orbs.length-1;i>=0;i--){
            const o=orbs[i];
            o.y+=o.vy*dt;
            if(o.y>game.clientHeight+40){o.el.remove(); orbs.splice(i,1);continue;}
            o.el.style.transform=`translate(${o.x}px,${o.y}px)`;
            if(rectsOverlap(player,o)){
            score+=5; scoreEl.textContent=score;
            popText('+5',o.x,o.y,'#9ef08a');
            soundCollect(); 
            o.el.remove(); orbs.splice(i,1);
            checkRewards();
            }
        }

        requestAnimationFrame(loop);
        }

        })();
    </script>
</body>
</html>
